<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Moje Zajęcia Praktyczne</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="welcome-popup" class="welcome-popup" style="display: none;"></div>
  <nav>
    <a href="zajecia_praktyczne.html" class="logo-link"><img src="logo.png" alt="Logo"></a>
    <div class="nav-links">
      <a href="info.html" id="nav-info">Info</a>
      <a href="zajecia_praktyczne.html" id="nav-zajecia">Zajęcia praktyczne</a>
      <a href="planowanie.html" id="nav-plan">Plan Jazd</a>
      <a href="index.html" onclick="sessionStorage.clear();">Wyloguj</a>
    </div>
  </nav>

  <div class="container">
    <h1 id="page-title">Moje Zajęcia Praktyczne</h1>
    
    <div id="student-schedule-view">
      <p style="text-align: center; margin-bottom: 20px;">Witaj <span id="student-name"></span>! Tutaj znajdziesz listę swoich zaplanowanych jazd.</p>
      
      <h2>Twoje zaplanowane jazdy:</h2>
      <!-- Tabela z istniejącymi jazdami ucznia -->
      <div id="student-schedule-table-container">
        <table>
          <thead>
            <tr>
              <th>Data</th>
              <th>Godzina</th>
              <th>Instruktor</th>
              <th>Status</th>
              <!-- Usunięto niepotrzebne nagłówki, dostosowując do displayStudentLessons -->
            </tr>
          </thead>
          <tbody id="student-lessons-table"> <!-- Zmieniono ID na student-lessons-table -->
            <tr><td colspan="4">Ładowanie harmonogramu...</td></tr> 
          </tbody>
        </table>
      </div>
    </div>

    <hr class="section-divider">

    <div id="booking-form-container" style="display: none;"> <!-- Ukryty, jeśli student-view nie jest aktywny -->
        <h2>Zarezerwuj nową jazdę:</h2>
        <div class="booking-form">
            <div>
                <label for="instructor">Instruktor:</label>
                <select id="instructor" name="instructor">
                    <option value="">Wybierz instruktora</option>
                    <option value="Muhamed Kebsik">Muhamed Kebsik</option>
                    <option value="Robert Lewandowski">Robert Lewandowski</option>
                    <option value="Konrad McGregor">Konrad McGregor</option>
                </select>
            </div>
            <div>
                <label for="duration">Czas trwania:</label>
                <select id="duration" name="duration">
                    <option value="1">1 godzina</option>
                    <option value="2">2 godziny</option>
                </select>
            </div>
            <div>
                <label for="date">Data:</label>
                <input type="date" id="date" name="date">
            </div>
            <button onclick="showAvailableSlots()" class="button-show-slots">Pokaż dostępne terminy</button>
        </div>

        <div id="available-slots" style="display:none; margin-top: 20px;">
            <h3>Dostępne terminy:</h3>
            <div id="slots-list"></div>
        </div>
    </div>

    <div id="unauthorized-view-student" style="display: none;">
        <p style="text-align: center; color: red;">Ta sekcja jest dostępna tylko dla zalogowanych uczniów.</p>
        <p style="text-align: center;">Jeśli jesteś instruktorem, przejdź do <a href="planowanie.html">Planu Jazd</a>.</p>
        <p style="text-align: center;">Jeśli nie jesteś zalogowany, przejdź do <a href="index.html">strony logowania</a>.</p>
    </div>

  </div>

  <script src="main.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const userId = sessionStorage.getItem('userId');
      const userRole = sessionStorage.getItem('userRole');
      const userName = sessionStorage.getItem('userName');

      const studentView = document.getElementById('student-schedule-view');
      const unauthorizedView = document.getElementById('unauthorized-view-student');
      const pageTitle = document.getElementById('page-title');

      if (userId && userRole && userName) {
        if (userRole === 'Uczniem') {
          pageTitle.textContent = 'Moje Zajęcia Praktyczne';
          document.getElementById('student-name').textContent = userName;
          studentView.style.display = 'block';
          document.getElementById('booking-form-container').style.display = 'block'; // Pokaż formularz rezerwacji
          // fetchAndDisplayLessons(); // Wywołanie jest już w main.js, więc tu niepotrzebne bezpośrednio
        } else {
          studentView.style.display = 'none';
          unauthorizedView.style.display = 'block';
        }
      } else {
           studentView.style.display = 'none';
         unauthorizedView.style.display = 'block';
      }
    });

    // Logika ładowania harmonogramu studenta została przeniesiona do main.js (fetchAndDisplayLessons)
    /* async function loadStudentSchedule(studentId) { ... } */

    async function confirmCancel(rideId, button) {
      if (confirm("Czy na pewno chcesz odwołać tę jazdę?")) {
        console.log(`Wysyłanie żądania odwołania jazdy o ID: ${rideId}`);
        let row = button.closest('tr');
        row.remove();
        alert("Jazda została odwołana (symulacja).");
      }
    }

  </script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
      const welcomeMessage = sessionStorage.getItem('welcomeMessage');
      const popup = document.getElementById('welcome-popup');

      if (welcomeMessage && popup) {
        popup.textContent = welcomeMessage;
        popup.style.display = 'block';

        setTimeout(() => {
          popup.style.display = 'none';
          sessionStorage.removeItem('welcomeMessage'); // Usuń wiadomość po wyświetleniu
        }, 3000); // Pokaż przez 3 sekundy
      }
    });
  </script>
</body>
</html>
