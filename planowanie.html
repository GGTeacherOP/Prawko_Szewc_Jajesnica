<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Plan Jazd</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="welcome-popup" class="welcome-popup" style="display: none;"></div>
  <nav>
    <a href="planowanie.html" class="logo-link"><img src="logo.png" alt="Logo"></a>
    <div class="nav-links">
      <a href="info.html" id="nav-info">Info</a>
      <a href="zajecia_praktyczne.html" id="nav-zajecia">Zajęcia praktyczne</a> 
      <a href="planowanie.html" id="nav-plan">Plan Jazd</a>
      <a href="index.html" onclick="sessionStorage.clear();">Wyloguj</a> 
    </div>
  </nav>

  <div class="container"> 
    <h1 id="page-title">Plan Jazd</h1>

    <div id="instructor-view" style="display: none;">
      <p style="text-align: center; margin-bottom: 20px;">Witaj <span id="instructor-name"></span>! Oto Twój harmonogram jazd:</p>
      <div id="instructor-schedule-table-container">
        <table>
          <thead>
            <tr>
              <th>Uczeń</th>
              <th>Data</th>
              <th>Godzina</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="instructor-lessons-table">
            <tr><td colspan="4">Ładowanie harmonogramu...</td></tr>
          </tbody>
        </table>
      </div>
       <p style="text-align: center; margin-top: 20px;">Jako instruktor, nie możesz planować jazd z tego miejsca. Uczniowie rezerwują jazdy przez zakładkę "Zajęcia praktyczne".</p>
    </div>

    <div id="student-view" style="display: none;">
       <p style="text-align: center; margin-bottom: 30px;">Ta sekcja ("Plan Jazd") jest przeznaczona głównie dla instruktorów do przeglądania ich harmonogramu.</p>
       <p style="text-align: center;">Aby zobaczyć swoje zaplanowane jazdy lub zarezerwować nowe, przejdź do zakładki <a href="zajecia_praktyczne.html">Zajęcia praktyczne</a>.</p>
    </div>
    
    <div id="unauthorized-view" style="display: none;">
    <div id="unauthorized-view" style="display: none;">
        <p style="text-align: center; color: red;">Nie jesteś zalogowany lub wystąpił błąd. Przejdź do <a href="index.html">strony logowania</a>.</p>
    </div>

  </div>

  <script src="main.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const userId = sessionStorage.getItem('userId');
      const userRole = sessionStorage.getItem('userRole');
      const userName = sessionStorage.getItem('userName');

      const instructorView = document.getElementById('instructor-view');
      const studentView = document.getElementById('student-view');
      const unauthorizedView = document.getElementById('unauthorized-view');
      const pageTitle = document.getElementById('page-title');

      if (userId && userRole && userName) {
        if (userRole === 'Instruktorem') {
          pageTitle.textContent = 'Harmonogram Instruktora';
          document.getElementById('instructor-name').textContent = userName;
          instructorView.style.display = 'block';
          // fetchAndDisplayLessons(); // Wywołanie jest już w main.js
        } else if (userRole === 'Uczniem') {
           pageTitle.textContent = 'Informacja dla Ucznia';
          studentView.style.display = 'block';
        } else {
          unauthorizedView.style.display = 'block';
        }
      } else {
        unauthorizedView.style.display = 'block';
      }
    });

    // Logika ładowania harmonogramu instruktora została przeniesiona do main.js (fetchAndDisplayLessons)
    /* async function loadInstructorSchedule(instructorId) { ... } */

    function confirmCancel(button) {
      if (confirm("Czy na pewno chcesz odwołać tę jazdę?")) {
        let row = button.closest('tr');
        row.remove();
        alert("Jazda została odwołana (symulacja).");
      }
    }
  </script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
      const welcomeMessage = sessionStorage.getItem('welcomeMessage');
      const popup = document.getElementById('welcome-popup');

      if (welcomeMessage && popup) {
        popup.textContent = welcomeMessage;
        popup.style.display = 'block';

        setTimeout(() => {
          popup.style.display = 'none';
          sessionStorage.removeItem('welcomeMessage'); // Usuń wiadomość po wyświetleniu
        }, 3000); // Pokaż przez 3 sekundy
      }
    });
  </script>
</body>
</html>